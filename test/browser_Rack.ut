/* See README.md at the root of this distribution for copyright and
   license information */
/* eslint-env node, mocha */

/**
 * Unit tests for Rack
 */
describe("Rack browser mixin", () => {

  const TS = require("./TestSupport.js");
  after(() => TS.after());
  before(required => {
    requirejs.isBrowser = true;
    TS.before({
      Rack: "game/Rack",
      Tile: "game/Tile",
      Square: "game/Square",
      jQueryUI: "jquery-ui"
    }, required);
  });

  it("$ui empty", () => {
    let r = new Rack("base", 2);

    let $act = r.$ui();
    assert($act.hasClass("rack"));

    let $dact = $("<div></div>").append($act);
    $("body").append($dact);

    let $exp = $('<table class="rack"><tr><td class="square-_"><div id="base_0"><a></a></div></td><td class="square-_"><div id="base_1"><a></a></div></td></tr></table>');

    let $dexp = $("<div></div>").append($exp);
    $("body").append($dexp);
    assert($act[0].isEqualNode($exp[0]),
           "\nexpected:" + $dexp.html() + "\n" +
           "  actual:" + $dact.html());
    $("body").empty();
  });

  it('$ui empty underlay', () => {
    let r = new Rack('base', 2, "Â£");

    let $act = r.$ui();
    assert($act.hasClass("rack"));

    let $dact = $("<div></div>").append($act);
    $("body").append($dact);

    let $exp = $('<table class="rack"><tbody><tr><td class="square-_"><div id="base_0"><a></a></div></td><td class="square-_"><div id="base_1"><a></a></div></td></tr></tbody></table>');

    let $dexp = $("<div></div>").append($exp);
    $("body").append($dexp);

    assert($act[0].isEqualNode($exp[0]),
           "\nexpected:" + $dexp.html() + "\n" +
           "  actual:" + $dact.html());

    $("body").empty();
  });

  it('$ui tiled', () => {
    let r = new Rack('base', 2);
    r.addTile(new Tile({letter:'S'}), 0, 0);
    r.addTile(new Tile({letter:'Q'}), 0, 0);

    assert.deepEqual(r.letters().sort(), ['Q', 'S']);

    let $act = r.$ui();
    assert($act.hasClass("rack"));

    let $dact = $("<div></div>").append($act);

    // Must be in the body before refresh or #id's won't be found
    $("body").append($dact);
    r.$refresh();

    let $exp = $('<table class="rack"><tbody><tr><td class="square-_"><div id="base_0" class="tiled-square temporary ui-draggable ui-draggable-handle"><a><span class="letter">S</span><span class="score">0</span></a></div></td><td class="square-_"><div id="base_1" class="tiled-square temporary ui-draggable ui-draggable-handle"><a><span class="letter">Q</span><span class="score">0</span></a></div></td></tr></tbody></table>');

    let $dexp = $("<div></div>").append($exp);

    assert($act[0].isEqualNode($exp[0]),
           "\nexpected:" + $dexp.html() + "\n" +
           "  actual:" + $dact.html());
    $("body").empty();
  });
});

