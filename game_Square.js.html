<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game/Square.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game/Square.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*Copyright (C) 2019-2022 The Xanado Project https://github.com/cdot/Xanado
  License MIT. See README.md at the root of this distribution for full copyright
  and license information. Author Crawford Currie http://c-dot.co.uk*/
/* eslint-env amd, jquery */

define("game/Square", [
  "platform"
], Platform => {

	// Map the characters in the board template to CSS classes
	const CSS_CLASS =  {
		M: /*i18n*/"square-M",
		Q: /*i18n*/"square-Q",
		q: /*i18n*/"square-q",
		T: /*i18n*/"square-T",
		t: /*i18n*/"square-t",
		D: /*i18n*/"square-D",
		d: /*i18n*/"square-d",
		_: /*i18n*/"square-_"
	};

	/**
	 * A square on the game board or rack. A Tile holder with some
	 * underlying attributes; a position, an owner, and a type that
	 * dictates the score multipliers that apply. The owner will be a
	 * subclass of {@linkcode Surface} (a {@linkcode Rack} or a {@linkcode Board})
	 */
	class Square {

		/**
     * @param {object} spec Specification
		 * @param {string} spec.type /^[QqTtSs_]$/ see {@linkcode Board}
		 * @param {Surface} spec.owner the container this is in
		 * @param {number} spec.col 0-based column where the square is
		 * @param {number?} spec.row 0-based row where the square is
		 * (undefined on a rack)
		 */
		constructor(spec) {
      /**
		   * /^[QqTtSs_]$/ see {@linkcode Board}
		   * @member {string}
		   */
			this.type = spec.type;

			/**
		   * Rack or Board
		   * @member {Surface?}
		   */
      this.owner = spec.owner; // Rack or Board

		  /**
		   * 0-based column where the square is.
		   * @member {number}
		   */
			this.col = spec.col;

		  /**
		   * Unique id for this square
		   * @member {string}
		   */
			this.id = `${this.owner.id}_${this.col}`;

			if (typeof spec.row !== "undefined") {
		    /**
		     * 0-based row where the square is (undefined on a 1D surface).
		     * @member {number?}
		     */
				this.row = spec.row;
				this.id += `x${this.row}`;
      }

      if (spec.tile) {
		    /**
		     * Tile placed on this square
		     * @member {Tile?}
		     */
		    this.tile = spec.tile;

		    if (spec.tileLocked)
		      /**
		       * True if the placed tile cannot be moved i.e. it was
		       * placed in a prior move. Locked tiles don't gather
		       * bonuses.
		       * @member {boolean}
           * @private
		       */
          this.tileLocked = true;
      }

		  if (spec.underlay)
        /**
		     * Underlay character to put in the background of the square when
		     * there is no tile present.
		     * @member {string}
		     */
		    this.underlay = spec.underlay;

		  /**
		   * Multiplier for letters using this square
		   * @member {number}
		   */
		  this.letterScoreMultiplier = 1;

		  /**
		   * Multiplier for words using this square
		   * @member {number}
		   */
		  this.wordScoreMultiplier = 1;

			// Determine score multipliers from type
			switch (this.type) {
			case "d": this.letterScoreMultiplier = 2; break;
			case "t": this.letterScoreMultiplier = 3; break;
			case "q": this.letterScoreMultiplier = 4; break;
			case "M":
			case "D": this.wordScoreMultiplier = 2; break;
			case "T": this.wordScoreMultiplier = 3; break;
			case "Q": this.wordScoreMultiplier = 4; break;
			}
		}

		/**
		 * @return true if the square doesn't have a tile placed on it
		 */
		isEmpty() {
			return !this.tile;
		}

    /**
     * @return {boolean} true if a tile is placed and it is locked
     */
    isLocked() {
      return this.tile &amp;&amp; this.tileLocked;
    }

		/**
		 * Place a tile on this square. Tiles are locked when a play is
		 * committed to a Board.
		 * @param {Tile} tile the tile to place
		 * @param {boolean} [lock] whether the tile is to be locked to
		 * the square (fixed on the board).
     * @return {Tile?} tile unplaced from the square, if any
		 */
		placeTile(tile, lock) {
      /* istanbul ignore if */
			if (tile &amp;&amp; this.tile &amp;&amp; tile !== this.tile) {
				console.error("Tile ", tile, " over ", this.tile);
				throw Error(`Square already occupied: ${this}`);
			}

      const oldTile = this.tile;
			tile.col = this.col;
			if (typeof this.row !== "undefined")
				tile.row = this.row;
			this.tile = tile;

      if (lock)
        this.tileLocked = true;

			// Used in the UI to update the square
			Platform.trigger("SquareChanged", [ this ]);

      return oldTile;
		}

		/**
		 * Remove the tile placed on this square.
     * @return {Tile?} tile unplaced from the square, if any
		 */
    unplaceTile() {
			// Note that a locked tile might be unplaced as
			// part of undoing a challenged play. Only then should
      // the tile letter be reset.
      const unplaced = this.tile;
			if (unplaced) {
        if (this.tileLocked) {
					unplaced.reset(); // clear letter
          delete this.tileLocked;
        }
        delete unplaced.col;
        delete unplaced.row;
				delete this.tile;

			  Platform.trigger("SquareChanged", [ this ]);
        return unplaced;
      }
      return undefined;
    }

		/**
		 * Create the jquery representation
		 * @param {string} base for id='s
		 */
		$ui() {
			const $td = $(`&lt;td>&lt;/td>`);
			$td.addClass(`square-${this.type}`);
			const $div = $(`&lt;div id="${this.id}">&lt;a>&lt;/a>&lt;/div>`);
			// Associate the square with the div for dragging
			$div.data("square", this);
			$td.append($div);
			return $td;
		}

		$refresh() {
			const $div = $(`#${this.id}`);

			/* istanbul ignore if */
			if ($div.length === 0)
				// No visual representation for this square - for
				// example, might be a square in another player's rack
				return;

			$div.removeClass("selected")
			.removeClass("temporary")
			.off("click");

			if (this.tile)
				this.refreshOccupied($div);
			else
				this.refreshEmpty($div);
		}

		/**
		 * Set the underlay; UI
		 * @param {boolean} sel 
		 */
		setUnderlay(ch) {
			this.underlay = ch;
		}

		/**
		 * Set the square as (un)selected; UI
		 * @param {boolean} sel 
		 */
		setSelected(sel) {
			/* istanbul ignore if */
			if (sel &amp;&amp; this.tile) {
				if (this.tileLocked)
					throw Error("Attempt to select locked tile");
				$(`#${this.id}`).addClass("selected");
			} else
				$(`#${this.id}`).removeClass("selected");
		}

		/**
		 * Update a square that has a Tile dropped on it
		 * @param {jQuery} $div the &lt;div> for the square
     * @private
		 */
		refreshOccupied($div) {
			if ($div.hasClass("ui-droppable"))
				/* istanbul ignore next */
				$div.droppable("destroy");

			$div
			.removeClass("empty-square")
			.addClass("tiled-square");

			if (this.tile.isBlank)
				$div.addClass("blank-letter");
			else
				$div.removeClass("blank-letter");

			if (this.tileLocked) {
				$div.addClass("Locked");
				if ($div.hasClass("ui-draggable"))
					/* istanbul ignore next */
					$div.draggable("destroy");
			} else {
				// tile isn't locked, valid drag source
				$div.removeClass("Locked");
				/* istanbul ignore next */
				$div
				.addClass("temporary")
				.on("click", () => Platform.trigger("SelectSquare", [ this ]));

				/* istanbul ignore next */
				$div.draggable({
					revert: "invalid",
					opacity: 1,
					helper: "clone",

					start: (event, jui) => {
						$div.css({ opacity: 0.5 });
						// Clear selection
						Platform.trigger("SelectSquare");
						// Configure drag helper
						$(jui.helper)
						.animate({"font-size" : "120%"}, 300)
						.addClass("drag-border");
					},

					drag: (event, jui) => $(jui.helper).addClass("drag-border"),

					stop: () => $div.css({ opacity: 1 })
				});
			}

			const letter = this.tile.letter;
			const score = this.tile.score;
			const $a = $("&lt;a>&lt;/a>");
			$a.append(`&lt;span class="letter">${letter}&lt;/span>`);
			$a.append(`&lt;span class="score">${score}&lt;/span>`);
			$div.empty().append($a);
		}

		/**
		 * Update a square that doesn't have a Tile dropped on it
		 * @param {jQuery} $div the &lt;div> for the square
     * @private
		 */
		refreshEmpty($div) {

			// Not draggable
			if ($div.hasClass("ui-draggable"))
				/* istanbul ignore next */
				$div.draggable("destroy");

			// no tile on the square, valid drop target
			$div
			.removeClass("tiled-square")
			.removeClass("blank-letter")
			.removeClass("Locked")
			.addClass("empty-square");

			/* istanbul ignore next */
			$div.on("click", () => Platform.trigger("SelectSquare", [ this ]))
			// Handle something dropping on us
			.droppable({
				hoverClass: "drop-active",
				drop: (event, jui) => {
					const source = $(jui.draggable).data("square");
					// Tell the main UI about it
					Platform.trigger("DropSquare", [ source, this ]);
				}
			});

			const text = Platform.i18n(`square-${this.type}`);
			$div.empty().append($("&lt;a>&lt;/a>").text(text));

			if (typeof this.underlay !== "undefined")
				$div.append(`&lt;div class="underlay">${this.underlay}&lt;/div>`);
		}

    /* istanbul ignore next */
    /**
     * @override
     */
		toString() {
			// All squares have a col
			let string = `${this.type} square @ ${this.col}`;
			// Squares on the board have a row too
			if (this.row >= 0)
				string += "," + this.row;

			if (this.tile) {
				string += ` => ${this.tile}`;
				if (this.tileLocked)
					string += " (Locked)";
			}
			return string;
		}
	}		

	return Square;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-dawg_compressor.html">dawg/compressor</a></li><li><a href="module-dawg_explore.html">dawg/explore</a></li><li><a href="module-design_valett.html">design/valett</a></li><li><a href="module-game_findBestPlay.html">game/findBestPlay</a></li></ul><h3>Classes</h3><ul><li><a href="Board.html">Board</a></li><li><a href="BrowserPlatform.html">BrowserPlatform</a></li><li><a href="Database.html">Database</a></li><li><a href="Dialog.html">Dialog</a></li><li><a href="Dictionary.html">Dictionary</a></li><li><a href="Edition.html">Edition</a></li><li><a href="FileDatabase.html">FileDatabase</a></li><li><a href="Fridge.html">Fridge</a></li><li><a href="Game.html">Game</a></li><li><a href="GamesUI.html">GamesUI</a></li><li><a href="GameUI.html">GameUI</a></li><li><a href="LetterBag.html">LetterBag</a></li><li><a href="LetterNode.html">LetterNode</a></li><li><a href="Move.html">Move</a></li><li><a href="Platform.html">Platform</a></li><li><a href="Player.html">Player</a></li><li><a href="Rack.html">Rack</a></li><li><a href="Server.html">Server</a></li><li><a href="ServerPlatform.html">ServerPlatform</a></li><li><a href="Square.html">Square</a></li><li><a href="Surface.html">Surface</a></li><li><a href="Tile.html">Tile</a></li><li><a href="Trie.html">Trie</a></li><li><a href="TrieNode.html">TrieNode</a></li><li><a href="Turn.html">Turn</a></li><li><a href="UI.html">UI</a></li><li><a href="UserManager.html">UserManager</a></li><li><a href="XanadoPass.html">XanadoPass</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Jun 25 2022 08:23:08 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
